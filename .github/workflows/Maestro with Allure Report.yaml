name: Maestro with Allure Report

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin' # Specify the Java distribution
          java-version: '11'      # Specify the Java version

      - name: Install Maestro
        run: |
          curl -Ls "https://get.maestro.mobile.dev" | bash
          export PATH="$PATH:$HOME/.maestro/bin"

      - name: Run Maestro tests
        run: |
          maestro test flows/ --format junit --output ./maestro-results/results.xml

      - name: Generate Allure report
        run: |
          npm install -g allure-commandline
          allure serve ./maestro-results